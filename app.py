# -*- coding: utf-8 -*-
"""app.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1QMFEmy-FKxrt2tfjW8cdevIiFE7IYMbR
"""

import streamlit as st
import numpy as np
import joblib

# Load saved model and scaler
model = joblib.load("random_forest_covid_model.pkl")
scaler = joblib.load("scaler.pkl")

st.title("üß™ COVID Risk Prediction App")
st.markdown("Enter patient data to predict COVID status (Healthy or Diseased).")

# Input features (must match X.columns in exact order!)
age = st.number_input("Age", min_value=0, max_value=120, value=30)
temperature = st.number_input("Temperature (¬∞C)", value=37.0)
heart_rate = st.number_input("Heart Rate (bpm)", value=80)
respiratory_rate = st.number_input("Respiratory Rate", value=18)
oxygen_saturation = st.number_input("Oxygen Saturation (%)", value=98)
wbc_count = st.number_input("WBC Count", value=7.0)
rbc_count = st.number_input("RBC Count", value=4.5)
hemoglobin = st.number_input("Hemoglobin", value=13.5)
platelet_count = st.number_input("Platelet Count", value=250)
d_dimer = st.number_input("D-Dimer", value=0.5)
crp = st.number_input("CRP", value=5.0)
ferritin = st.number_input("Ferritin", value=100)
ldh = st.number_input("LDH", value=200)
alt = st.number_input("ALT", value=25)

# Feature engineering
inflammation_index = np.mean([crp, ferritin, ldh])

# Prepare input in correct order
input_data = np.array([[
    age, temperature, heart_rate, respiratory_rate,
    oxygen_saturation, wbc_count, rbc_count, hemoglobin,
    platelet_count, d_dimer, crp, ferritin, ldh, alt,
    inflammation_index
]])

# Scale the input
scaled_input = scaler.transform(input_data)

# Predict
if st.button("Predict COVID Status"):
    prediction = model.predict(scaled_input)[0]
    probability = model.predict_proba(scaled_input)[0][1]

    if prediction == 1:
        st.success(f"‚úÖ Patient is likely **Healthy** ({(1 - probability) * 100:.2f}% confidence).")
    else:
        st.error(f"‚ö†Ô∏è Patient is likely **Diseased** ({probability * 100:.2f}% confidence).")